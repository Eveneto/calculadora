name: ğŸ—ï¸ Build Multi-Platform

on:
  push:
    branches: [ main ]
    tags: [ 'v*' ]
  pull_request:
    branches: [ main ]

jobs:
  build-windows:
    runs-on: windows-latest
    
    steps:
    - name: ğŸ“¥ Checkout
      uses: actions/checkout@v4
      
    - name: ğŸ› ï¸ Install Qt
      uses: jurplel/install-qt-action@v3
      with:
        version: '6.5.0'
        target: 'desktop'
        arch: 'win64_mingw'
        
    - name: ğŸ”§ Configure CMake
      run: cmake -B build -G "MinGW Makefiles"
      
    - name: ğŸ—ï¸ Build
      run: cmake --build build --config Release
      
    - name: ğŸ“¦ Deploy Qt
      run: |
        mkdir deploy
        copy build\calculadora.exe deploy\
        windeployqt deploy\calculadora.exe
        
    - name: ğŸ“‹ Create portable version
      run: |
        Compress-Archive -Path deploy\* -DestinationPath calculadora-windows-portable.zip
        
    - name: ğŸš€ Upload Windows artifacts
      uses: actions/upload-artifact@v4
      with:
        name: calculadora-windows
        path: |
          calculadora-windows-portable.zip
          deploy/

  build-linux:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout
      uses: actions/checkout@v4
      
    - name: ğŸ› ï¸ Install dependencies
      run: |
        sudo apt update
        sudo apt install qt6-base-dev qt6-tools-dev cmake build-essential
        
    - name: ğŸ”§ Configure CMake
      run: cmake -B build
      
    - name: ğŸ—ï¸ Build
      run: cmake --build build
      
    - name: ğŸ“¦ Create AppImage (optional)
      run: |
        mkdir -p AppDir/usr/bin
        cp build/calculadora AppDir/usr/bin/
        # TODO: Add AppImage creation steps
        
    - name: ğŸš€ Upload Linux artifacts
      uses: actions/upload-artifact@v4
      with:
        name: calculadora-linux
        path: build/calculadora

  release:
    needs: [build-windows, build-linux]
    runs-on: ubuntu-latest
    if: startsWith(github.ref, 'refs/tags/')
    
    steps:
    - name: ğŸ“¥ Download artifacts
      uses: actions/download-artifact@v4
      
    - name: ğŸ‰ Create Release
      uses: softprops/action-gh-release@v1
      with:
        files: |
          calculadora-windows/calculadora-windows-portable.zip
          calculadora-linux/calculadora
        body: |
          ğŸ‰ **Calculadora Qt C++ v${{ github.ref_name }}**
          
          âœ¨ **Funcionalidades:**
          - Interface grÃ¡fica moderna
          - OperaÃ§Ãµes matemÃ¡ticas bÃ¡sicas (+, -, Ã—, Ã·)
          - HistÃ³rico de operaÃ§Ãµes
          - Suporte completo a teclado
          - FormataÃ§Ã£o brasileira de nÃºmeros
          - ValidaÃ§Ã£o e tratamento de erros
          
          ğŸ“¦ **Downloads:**
          - **Windows**: `calculadora-windows-portable.zip` (sem instalaÃ§Ã£o)
          - **Linux**: `calculadora` (executÃ¡vel)
          
          ğŸ”§ **Windows**: Apenas extrair e executar `calculadora.exe`
          ğŸ§ **Linux**: `chmod +x calculadora && ./calculadora`
          
        draft: false
        prerelease: false
